<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Diagnostika - Bulldogo.cz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status.pending {
            background: #ffa500;
            color: white;
        }
        .status.success {
            background: #4caf50;
            color: white;
        }
        .status.error {
            background: #f44336;
            color: white;
        }
        .status.warning {
            background: #ff9800;
            color: white;
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #ddd;
        }
        .test-item.success {
            border-left-color: #4caf50;
        }
        .test-item.error {
            border-left-color: #f44336;
        }
        .test-item.warning {
            border-left-color: #ff9800;
        }
        .test-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .test-value {
            color: #666;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            word-break: break-all;
        }
        .test-details {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            font-size: 13px;
            color: #555;
        }
        .solution {
            margin-top: 15px;
            padding: 15px;
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            border-radius: 4px;
        }
        .solution h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        .solution ol {
            margin-left: 20px;
            color: #333;
        }
        .solution li {
            margin: 5px 0;
        }
        .btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #1976d2;
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            margin-top: 20px;
            padding: 15px;
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
        }
        .log-entry.error {
            color: #f48771;
        }
        .log-entry.success {
            color: #4ec9b0;
        }
        .log-entry.warning {
            color: #dcdcaa;
        }
        .log-entry.info {
            color: #569cd6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Firebase Diagnostika</h1>
        <p class="subtitle">Komplexn√≠ kontrola Firebase konfigurace a probl√©m≈Ø s Firestore</p>
        
        <button class="btn" onclick="runDiagnostics()">‚ñ∂Ô∏è Spustit diagnostiku</button>
        <button class="btn" onclick="clearLog()">üóëÔ∏è Vymazat log</button>
        
        <div id="results"></div>
        <div id="log" class="log" style="display: none;"></div>
    </div>

    <!-- Firebase SDK - naƒç√≠t√°me p≈ô√≠mo, ne p≈ôes firebase-init.js -->
    <script type="module">
        // Inicializace Firebase p≈ô√≠mo v diagnostick√© str√°nce
        import { initializeApp, getApps } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, initializeFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyA1FEmsY458LLKQLGcUaOVXsYr3Ii55QeQ",
            authDomain: "inzerio-inzerce.firebaseapp.com",
            projectId: "inzerio-inzerce",
            storageBucket: "inzerio-inzerce.appspot.com",
            messagingSenderId: "262039290071",
            appId: "1:262039290071:web:30af0eb1c65cd75e307092",
            measurementId: "G-7VD0ZE08M3"
        };
        
        try {
            let app;
            if (getApps().length) {
                app = getApps()[0];
            } else {
                app = initializeApp(firebaseConfig);
            }
            
            const auth = getAuth(app);
            let db;
            try {
                db = initializeFirestore(app, { experimentalAutoDetectLongPolling: true, useFetchStreams: false });
            } catch (err) {
                db = getFirestore(app);
            }
            
            window.firebaseApp = app;
            window.firebaseAuth = auth;
            window.firebaseDb = db;
            window.firebaseAppCheck = null; // App Check vypnut√Ω
            window.firebaseReady = true;
            
            console.log('‚úÖ Firebase inicializov√°n v diagnostick√© str√°nce');
        } catch (error) {
            console.error('‚ùå Chyba p≈ôi inicializaci Firebase:', error);
            window.firebaseError = error;
        }
    </script>

    <script type="module">
        const log = [];
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            log.push({ timestamp, message, type });
            updateLogDisplay();
        }
        
        function updateLogDisplay() {
            const logDiv = document.getElementById('log');
            logDiv.style.display = 'block';
            logDiv.innerHTML = log.map(entry => {
                const icon = {
                    'error': '‚ùå',
                    'success': '‚úÖ',
                    'warning': '‚ö†Ô∏è',
                    'info': '‚ÑπÔ∏è'
                }[entry.type] || 'üìù';
                return `<div class="log-entry ${entry.type}">[${entry.timestamp}] ${icon} ${entry.message}</div>`;
            }).join('');
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            log.length = 0;
            document.getElementById('log').style.display = 'none';
        }
        
        async function runDiagnostics() {
            addLog('Spou≈°t√≠m diagnostiku...', 'info');
            document.getElementById('results').innerHTML = '<p>‚è≥ Prob√≠h√° diagnostika...</p>';
            
            const results = {
                firebaseInit: await testFirebaseInit(),
                appCheck: await testAppCheck(),
                firestoreRules: await testFirestoreRules(),
                appCheckEnforcement: await testAppCheckEnforcement(),
                firestoreConnection: await testFirestoreConnection(),
                collectionGroup: await testCollectionGroup(),
                auth: await testAuth()
            };
            
            displayResults(results);
        }
        
        async function testFirebaseInit() {
            addLog('Test 1: Kontrola Firebase inicializace...', 'info');
            const result = {
                name: 'Firebase Inicializace',
                status: 'pending',
                items: []
            };
            
            try {
                // Poƒçkat na Firebase
                let attempts = 0;
                while (!window.firebaseApp && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (!window.firebaseApp) {
                    result.status = 'error';
                    result.items.push({
                        label: 'Firebase App',
                        value: 'NENALEZEN',
                        status: 'error'
                    });
                    addLog('‚ùå Firebase App nen√≠ dostupn√Ω', 'error');
                    return result;
                }
                
                result.items.push({
                    label: 'Firebase App',
                    value: 'Dostupn√Ω',
                    status: 'success'
                });
                
                if (window.firebaseAuth) {
                    result.items.push({
                        label: 'Firebase Auth',
                        value: 'Dostupn√Ω',
                        status: 'success'
                    });
                } else {
                    result.items.push({
                        label: 'Firebase Auth',
                        value: 'NENALEZEN',
                        status: 'error'
                    });
                }
                
                if (window.firebaseDb) {
                    result.items.push({
                        label: 'Firebase Firestore',
                        value: 'Dostupn√Ω',
                        status: 'success'
                    });
                } else {
                    result.items.push({
                        label: 'Firebase Firestore',
                        value: 'NENALEZEN',
                        status: 'error'
                    });
                }
                
                result.status = window.firebaseApp && window.firebaseAuth && window.firebaseDb ? 'success' : 'error';
                addLog('‚úÖ Firebase inicializace: ' + result.status, result.status);
                
            } catch (error) {
                result.status = 'error';
                result.items.push({
                    label: 'Chyba',
                    value: error.message,
                    status: 'error'
                });
                addLog('‚ùå Chyba p≈ôi kontrole Firebase: ' + error.message, 'error');
            }
            
            return result;
        }
        
        async function testAppCheck() {
            addLog('Test 2: Kontrola App Check...', 'info');
            const result = {
                name: 'App Check Konfigurace',
                status: 'pending',
                items: []
            };
            
            try {
                const hostname = window.location.hostname;
                const isLocal = hostname === 'localhost' || hostname === '127.0.0.1';
                
                result.items.push({
                    label: 'Hostname',
                    value: hostname,
                    status: 'info'
                });
                
                result.items.push({
                    label: 'Je localhost?',
                    value: isLocal ? 'Ano' : 'Ne',
                    status: isLocal ? 'warning' : 'success'
                });
                
                const appCheckDisabled = window.DISABLE_APP_CHECK === true;
                const appCheckEnabled = window.ENABLE_APP_CHECK === true;
                
                result.items.push({
                    label: 'DISABLE_APP_CHECK',
                    value: appCheckDisabled ? 'true (vypnut√Ω)' : 'false/undefined',
                    status: appCheckDisabled ? 'success' : 'warning'
                });
                
                result.items.push({
                    label: 'ENABLE_APP_CHECK',
                    value: appCheckEnabled ? 'true (zapnut√Ω)' : 'false/undefined',
                    status: appCheckEnabled ? 'warning' : 'success'
                });
                
                const appCheckInitialized = window.firebaseAppCheck !== null && window.firebaseAppCheck !== undefined;
                
                result.items.push({
                    label: 'App Check inicializov√°n?',
                    value: appCheckInitialized ? 'ANO (PROBL√âM!)' : 'Ne (OK)',
                    status: appCheckInitialized ? 'error' : 'success'
                });
                
                if (appCheckInitialized) {
                    result.items.push({
                        label: '‚ö†Ô∏è VAROV√ÅN√ç',
                        value: 'App Check je inicializov√°n i kdy≈æ by nemƒõl b√Ωt!',
                        status: 'error',
                        details: 'App Check m≈Ø≈æe blokovat Firestore po≈æadavky. Mƒõl by b√Ωt vypnut√Ω pro produkci.'
                    });
                }
                
                result.status = appCheckInitialized ? 'error' : 'success';
                addLog(appCheckInitialized ? '‚ùå App Check je inicializov√°n (PROBL√âM!)' : '‚úÖ App Check je vypnut√Ω (OK)', appCheckInitialized ? 'error' : 'success');
                
            } catch (error) {
                result.status = 'error';
                result.items.push({
                    label: 'Chyba',
                    value: error.message,
                    status: 'error'
                });
            }
            
            return result;
        }
        
        async function testFirestoreRules() {
            addLog('Test 3: Test Firestore pravidel...', 'info');
            const result = {
                name: 'Firestore Security Rules',
                status: 'pending',
                items: []
            };
            
            try {
                if (!window.firebaseDb) {
                    result.status = 'error';
                    result.items.push({
                        label: 'Firestore DB',
                        value: 'Nen√≠ dostupn√Ω',
                        status: 'error'
                    });
                    return result;
                }
                
                // Test 1: ƒåten√≠ users dokumentu
                try {
                    const { collection, getDocs, query, limit } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                    const usersRef = collection(window.firebaseDb, 'users');
                    const q = query(usersRef, limit(1));
                    const snapshot = await getDocs(q);
                    
                    result.items.push({
                        label: 'ƒåten√≠ users kolekce',
                        value: 'POVOLENO',
                        status: 'success'
                    });
                    addLog('‚úÖ ƒåten√≠ users kolekce: POVOLENO', 'success');
                } catch (error) {
                    result.items.push({
                        label: 'ƒåten√≠ users kolekce',
                        value: 'ZAK√ÅZ√ÅNO: ' + error.message,
                        status: 'error',
                        details: 'Pravidla neumo≈æ≈àuj√≠ ƒçten√≠ users kolekce. Zkontrolujte Firebase Console ‚Üí Firestore ‚Üí Rules'
                    });
                    addLog('‚ùå ƒåten√≠ users kolekce: ZAK√ÅZ√ÅNO - ' + error.message, 'error');
                }
                
                // Test 2: CollectionGroup dotaz
                try {
                    const { collectionGroup, getDocs, query, limit } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                    const inzeratyRef = collectionGroup(window.firebaseDb, 'inzeraty');
                    const q = query(inzeratyRef, limit(1));
                    const snapshot = await getDocs(q);
                    
                    result.items.push({
                        label: 'CollectionGroup("inzeraty") dotaz',
                        value: 'POVOLENO - ' + snapshot.docs.length + ' dokument≈Ø',
                        status: 'success'
                    });
                    addLog('‚úÖ CollectionGroup dotaz: POVOLENO', 'success');
                    result.status = 'success';
                } catch (error) {
                    result.items.push({
                        label: 'CollectionGroup("inzeraty") dotaz',
                        value: 'ZAK√ÅZ√ÅNO: ' + error.message,
                        status: 'error',
                        details: 'CollectionGroup dotazy vy≈æaduj√≠: allow read: if true; pro users/{userId}/{document=**}'
                    });
                    addLog('‚ùå CollectionGroup dotaz: ZAK√ÅZ√ÅNO - ' + error.message, 'error');
                    result.status = 'error';
                }
                
            } catch (error) {
                result.status = 'error';
                result.items.push({
                    label: 'Chyba',
                    value: error.message,
                    status: 'error'
                });
            }
            
            return result;
        }
        
        async function testAppCheckEnforcement() {
            addLog('Test 4: Kontrola App Check Enforcement...', 'info');
            const result = {
                name: 'App Check Enforcement (Firebase Console)',
                status: 'pending',
                items: []
            };
            
            // Toto nelze zkontrolovat programovƒõ, mus√≠ se zkontrolovat ruƒçnƒõ
            result.items.push({
                label: '‚ö†Ô∏è Nelze zkontrolovat automaticky',
                value: 'Mus√≠te zkontrolovat ruƒçnƒõ v Firebase Console',
                status: 'warning',
                details: 'Jdƒõte na: Firebase Console ‚Üí App Check ‚Üí Settings ‚Üí Cloud Firestore. Mƒõlo by b√Ωt "Monitor" nebo "Off", ne "Enforce".'
            });
            
            result.items.push({
                label: 'Co zkontrolovat',
                value: 'Firebase Console ‚Üí App Check ‚Üí Settings',
                status: 'info',
                details: '1. Otev≈ôete Firebase Console\n2. App Check ‚Üí Settings\n3. Najdƒõte Cloud Firestore\n4. Mƒõlo by b√Ωt "Monitor" nebo "Off"\n5. Pokud je "Enforce" ‚Üí zmƒõ≈àte na "Monitor" nebo "Off"'
            });
            
            result.status = 'warning';
            addLog('‚ö†Ô∏è App Check Enforcement mus√≠ b√Ωt zkontrolov√°n ruƒçnƒõ v Firebase Console', 'warning');
            
            return result;
        }
        
        async function testFirestoreConnection() {
            addLog('Test 5: Test p≈ôipojen√≠ k Firestore...', 'info');
            const result = {
                name: 'Firestore P≈ôipojen√≠',
                status: 'pending',
                items: []
            };
            
            try {
                if (!window.firebaseDb) {
                    result.status = 'error';
                    result.items.push({
                        label: 'Firestore DB',
                        value: 'Nen√≠ dostupn√Ω',
                        status: 'error'
                    });
                    return result;
                }
                
                const { collection, getDocs, query, limit } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                
                // Test p≈ôipojen√≠
                const testRef = collection(window.firebaseDb, 'users');
                const q = query(testRef, limit(1));
                const startTime = Date.now();
                const snapshot = await getDocs(q);
                const duration = Date.now() - startTime;
                
                result.items.push({
                    label: 'P≈ôipojen√≠ k Firestore',
                    value: '√öSPƒö≈†N√â (' + duration + 'ms)',
                    status: 'success'
                });
                
                result.items.push({
                    label: 'Latence',
                    value: duration + 'ms',
                    status: duration < 1000 ? 'success' : 'warning'
                });
                
                result.status = 'success';
                addLog('‚úÖ Firestore p≈ôipojen√≠: √öSPƒö≈†N√â', 'success');
                
            } catch (error) {
                result.status = 'error';
                result.items.push({
                    label: 'P≈ôipojen√≠ k Firestore',
                    value: 'SELHALO: ' + error.message,
                    status: 'error',
                    details: 'Error code: ' + (error.code || 'unknown') + '\nError message: ' + error.message
                });
                addLog('‚ùå Firestore p≈ôipojen√≠: SELHALO - ' + error.message, 'error');
            }
            
            return result;
        }
        
        async function testCollectionGroup() {
            addLog('Test 6: Test CollectionGroup dotazu na inzer√°ty...', 'info');
            const result = {
                name: 'CollectionGroup("inzeraty") Dotaz',
                status: 'pending',
                items: []
            };
            
            try {
                if (!window.firebaseDb) {
                    result.status = 'error';
                    result.items.push({
                        label: 'Firestore DB',
                        value: 'Nen√≠ dostupn√Ω',
                        status: 'error'
                    });
                    return result;
                }
                
                const { collectionGroup, getDocs } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const inzeratyRef = collectionGroup(window.firebaseDb, 'inzeraty');
                
                const startTime = Date.now();
                const snapshot = await getDocs(inzeratyRef);
                const duration = Date.now() - startTime;
                
                const count = snapshot.docs.length;
                
                result.items.push({
                    label: 'Dotaz √∫spƒõ≈°n√Ω?',
                    value: 'ANO',
                    status: 'success'
                });
                
                result.items.push({
                    label: 'Poƒçet inzer√°t≈Ø',
                    value: count + ' dokument≈Ø',
                    status: count > 0 ? 'success' : 'warning'
                });
                
                result.items.push({
                    label: 'Doba dotazu',
                    value: duration + 'ms',
                    status: 'info'
                });
                
                if (count === 0) {
                    result.items.push({
                        label: '‚ö†Ô∏è POZOR',
                        value: '≈Ω√°dn√© inzer√°ty nenalezeny',
                        status: 'warning',
                        details: 'Buƒè v datab√°zi nejsou ≈æ√°dn√© inzer√°ty, nebo pravidla neumo≈æ≈àuj√≠ ƒçten√≠.'
                    });
                }
                
                // Zkontrolovat metadata
                result.items.push({
                    label: 'Metadata',
                    value: 'fromCache: ' + snapshot.metadata.fromCache + ', hasPendingWrites: ' + snapshot.metadata.hasPendingWrites,
                    status: 'info'
                });
                
                result.status = 'success';
                addLog('‚úÖ CollectionGroup dotaz: √öSPƒö≈†N√ù - ' + count + ' inzer√°t≈Ø', 'success');
                
            } catch (error) {
                result.status = 'error';
                result.items.push({
                    label: 'Dotaz selhal',
                    value: error.message,
                    status: 'error',
                    details: 'Error code: ' + (error.code || 'unknown') + '\n\nMo≈æn√© p≈ô√≠ƒçiny:\n' +
                        '1. Firestore pravidla neumo≈æ≈àuj√≠ collectionGroup dotazy\n' +
                        '2. App Check enforcement je zapnut√Ω v Firebase Console\n' +
                        '3. Pravidla nejsou publikovan√° v Firebase Console'
                });
                addLog('‚ùå CollectionGroup dotaz: SELHAL - ' + error.message, 'error');
            }
            
            return result;
        }
        
        async function testAuth() {
            addLog('Test 7: Kontrola Firebase Auth...', 'info');
            const result = {
                name: 'Firebase Auth',
                status: 'pending',
                items: []
            };
            
            try {
                if (!window.firebaseAuth) {
                    result.status = 'error';
                    result.items.push({
                        label: 'Firebase Auth',
                        value: 'Nen√≠ dostupn√Ω',
                        status: 'error'
                    });
                    return result;
                }
                
                const currentUser = window.firebaseAuth.currentUser;
                
                result.items.push({
                    label: 'Firebase Auth',
                    value: 'Dostupn√Ω',
                    status: 'success'
                });
                
                result.items.push({
                    label: 'P≈ôihl√°≈°en√Ω u≈æivatel',
                    value: currentUser ? currentUser.email : 'Nen√≠ p≈ôihl√°≈°en',
                    status: currentUser ? 'success' : 'info'
                });
                
                if (currentUser) {
                    result.items.push({
                        label: 'User ID',
                        value: currentUser.uid,
                        status: 'info'
                    });
                }
                
                result.status = 'success';
                addLog('‚úÖ Firebase Auth: ' + (currentUser ? 'P≈ôihl√°≈°en: ' + currentUser.email : 'Nen√≠ p≈ôihl√°≈°en'), 'success');
                
            } catch (error) {
                result.status = 'error';
                result.items.push({
                    label: 'Chyba',
                    value: error.message,
                    status: 'error'
                });
            }
            
            return result;
        }
        
        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            let html = '';
            
            for (const [key, result] of Object.entries(results)) {
                html += `
                    <div class="test-section">
                        <h2>
                            ${result.name}
                            <span class="status ${result.status}">${result.status}</span>
                        </h2>
                        ${result.items.map(item => `
                            <div class="test-item ${item.status}">
                                <div class="test-label">${item.label}</div>
                                <div class="test-value">${item.value}</div>
                                ${item.details ? `<div class="test-details">${item.details.replace(/\n/g, '<br>')}</div>` : ''}
                            </div>
                        `).join('')}
                        ${getSolution(result)}
                    </div>
                `;
            }
            
            // Shrnut√≠
            const hasErrors = Object.values(results).some(r => r.status === 'error');
            const hasWarnings = Object.values(results).some(r => r.status === 'warning');
            
            html = `
                <div class="test-section" style="background: ${hasErrors ? '#ffebee' : hasWarnings ? '#fff3e0' : '#e8f5e9'};">
                    <h2>üìä Shrnut√≠</h2>
                    <div class="test-item">
                        <div class="test-label">Celkov√Ω stav</div>
                        <div class="test-value">${hasErrors ? '‚ùå Nalezeny chyby' : hasWarnings ? '‚ö†Ô∏è Nalezena varov√°n√≠' : '‚úÖ V≈°e v po≈ô√°dku'}</div>
                    </div>
                    ${getOverallSolution(results)}
                </div>
            ` + html;
            
            resultsDiv.innerHTML = html;
        }
        
        function getSolution(result) {
            if (result.status === 'error' || result.status === 'warning') {
                if (result.name.includes('App Check')) {
                    return `
                        <div class="solution">
                            <h3>üí° ≈òe≈°en√≠</h3>
                            <ol>
                                <li>Zkontrolujte, ≈æe <code>window.DISABLE_APP_CHECK = true</code> je nastaveno p≈ôed naƒçten√≠m firebase-init.js</li>
                                <li>Zkontrolujte Firebase Console ‚Üí App Check ‚Üí Settings ‚Üí Cloud Firestore</li>
                                <li>Nastavte App Check enforcement na "Monitor" nebo "Off" (ne "Enforce")</li>
                            </ol>
                        </div>
                    `;
                } else if (result.name.includes('Firestore Rules') || result.name.includes('CollectionGroup')) {
                    return `
                        <div class="solution">
                            <h3>üí° ≈òe≈°en√≠</h3>
                            <ol>
                                <li>Otev≈ôete Firebase Console ‚Üí Firestore Database ‚Üí Rules</li>
                                <li>Zkop√≠rujte obsah z <code>firestore-rules.txt</code></li>
                                <li>Vlo≈æte do Firebase Console</li>
                                <li><strong>KLIKNƒöTE NA "PUBLISH"</strong> (d≈Øle≈æit√©!)</li>
                                <li>Zkontrolujte App Check enforcement (mƒõlo by b√Ωt Monitor/Off)</li>
                            </ol>
                        </div>
                    `;
                }
            }
            return '';
        }
        
        function getOverallSolution(results) {
            const hasRuleErrors = results.firestoreRules?.status === 'error' || results.collectionGroup?.status === 'error';
            const hasAppCheckErrors = results.appCheck?.status === 'error';
            
            if (hasRuleErrors || hasAppCheckErrors) {
                return `
                    <div class="solution">
                        <h3>üéØ Hlavn√≠ ≈ôe≈°en√≠</h3>
                        <ol>
                            ${hasRuleErrors ? '<li><strong>Opravit Firestore pravidla:</strong><br>Firebase Console ‚Üí Firestore ‚Üí Rules ‚Üí Zkop√≠rovat z firestore-rules.txt ‚Üí <strong>PUBLISH</strong></li>' : ''}
                            ${hasAppCheckErrors ? '<li><strong>Vypnout App Check enforcement:</strong><br>Firebase Console ‚Üí App Check ‚Üí Settings ‚Üí Cloud Firestore ‚Üí Nastavit na "Monitor" nebo "Off"</li>' : ''}
                            <li>Poƒçkat 30-60 sekund</li>
                            <li>Obnovit str√°nku (Ctrl+F5)</li>
                        </ol>
                    </div>
                `;
            }
            return '';
        }
        
        // Automaticky spustit diagnostiku po naƒçten√≠
        window.addEventListener('load', () => {
            // Poƒçkat na naƒçten√≠ Firebase modul≈Ø
            setTimeout(() => {
                // Zkusit poƒçkat na Firebase
                let attempts = 0;
                const checkFirebase = setInterval(() => {
                    attempts++;
                    if (window.firebaseReady || window.firebaseApp) {
                        clearInterval(checkFirebase);
                        addLog('‚úÖ Firebase je p≈ôipraven, spou≈°t√≠m diagnostiku...', 'success');
                        runDiagnostics();
                    } else if (attempts > 20) {
                        clearInterval(checkFirebase);
                        addLog('‚ö†Ô∏è Firebase se nenaƒçetl po 10 sekund√°ch, spou≈°t√≠m diagnostiku s dostupn√Ωmi informacemi...', 'warning');
                        runDiagnostics();
                    }
                }, 500);
            }, 1000);
        });
    </script>
</body>
</html>

